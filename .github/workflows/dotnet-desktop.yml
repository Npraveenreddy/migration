name: Build All APIs

on:
  push:
    branches:
      - main
      - master
    paths:
      - '.github/workflows/**'
      - 'AHS.GC.Web/**'
      - 'AHS.GC.authorizationportal/**'
      - 'AHS.GC.ConfigAPI/**'
      - 'AHS.GC.SmartComm/**'
      - 'AHS.GC.Cloud/**'

  workflow_dispatch: # allow manual run from GitHub Actions tab

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '6.0.x'

      - name: Restore dependencies
        run: |
          dotnet restore "./AHS.GC.Web/AHS.GC.Web.csproj"
          dotnet restore "./AHS.GC.authorizationportal/AHS.GC.authorizationportal.csproj"
          dotnet restore "./AHS.GC.ConfigAPI/AHS.GC.ConfigAPI.csproj"
          dotnet restore "./AHS.GC.SmartComm/AHS.GC.SmartComm.csproj"
          dotnet restore "./AHS.GC.Cloud/AHS.GC.Cloud.csproj"

      - name: Build projects
        run: |
          dotnet build "./AHS.GC.Web/AHS.GC.Web.csproj" --configuration Release --no-restore
          dotnet build "./AHS.GC.authorizationportal/AHS.GC.authorizationportal.csproj" --configuration Release --no-restore
          dotnet build "./AHS.GC.ConfigAPI/AHS.GC.ConfigAPI.csproj" --configuration Release --no-restore
          dotnet build "./AHS.GC.SmartComm/AHS.GC.SmartComm.csproj" --configuration Release --no-restore
          dotnet build "./AHS.GC.Cloud/AHS.GC.Cloud.csproj" --configuration Release --no-restore
